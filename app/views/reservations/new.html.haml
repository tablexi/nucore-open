= content_for :head_content do
  %script{:type => 'text/javascript', :src => "#{request.protocol}ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"}
  = javascript_include_tag 'date.js'
  = javascript_include_tag 'calendar/fullcalendar.min.js'
  = javascript_include_tag 'jquery.qtip-1.0.0-rc3.min.js'
  = javascript_include_tag 'reservations.js'
  = stylesheet_link_tag 'calendar/fullcalendar.css'
  = stylesheet_link_tag 'calendar/fullcalendar.extensions.css'
  :javascript
    var events_path     = "#{facility_instrument_reservations_url(@instrument.facility, @instrument, :format => 'js', :with_details => @instrument.show_details?)}";
    var minDate         = "#{@min_date}";
    var maxDate         = "#{@max_date}";
    var maxDaysFromNow  = #{@max_window};
    var minDaysFromNow  = #{@max_days_ago};
    var minTime         = #{@instrument.first_available_hour};
    var maxTime         = #{@instrument.last_available_hour+1};
    var withDetails     = #{@instrument.show_details? || false};
    var isBundle        = #{@order_detail.bundled?};
    var ctrlMechanism   = "#{@instrument.control_mechanism}";

= content_for :breadcrumb do
  %ul.horiz
    %li= link_to 'Home', facilities_path
    %li &raquo;
    %li= link_to @instrument.facility, facility_path(@instrument.facility)
    %li &raquo;
    %li= link_to 'Cart', order_path(@order)
    %li &raquo;
    %li= t('.crumb')

= content_for :h1 do
  =h @instrument.facility

%h2=h @instrument

.wysiwyg= @instrument.description

- docs = @instrument.file_uploads.info
- unless docs.empty?
  %h3= t('.h3')
  %ul
    - docs.each do |file_upload|
      %li.document= link_to file_upload.name, file_upload.file.url, :target => '_blank'

= form_for([@order, @order_detail, @reservation]) do |f|
  = f.error_messages
  - unless @order_detail.bundled?
    %ul.form.box
      %li.left
        = label_tag 'order_account', t('.label')
        - options=@order.user.accounts.active.for_facility(@instrument.facility)
        - options.reject!{|acct| !acct.validate_against_product(@instrument, @order.user).nil?}
        - options.collect!{|acct| [acct.to_s ,acct.id] }
        - options.unshift(Array.new(2)) if options.size > 1
        = select_tag 'order_account', options_for_select(options, @order.account_id)
      - if acting_as?
        %li.left
          = f.label       :note
          = f.text_field  :note, :size => 100, :maxlength => 100
      %li.clear
  %ul.form.box
    = render :partial => 'reservation_fields', :locals => {:f => f}
  %ul.horiz
    %li= f.submit 'Create', :class => 'btn'
    - url_after_action = facility_url(@instrument.facility)
    - if @order_detail.bundled?
      %li= link_to 'Cancel', url_after_action
    - else 
      %li= link_to 'Cancel', remove_order_path(@order, @order_detail, :redirect_to => url_after_action), :method => :put

#overlay
  #spinner
    #hide
      #calendar
